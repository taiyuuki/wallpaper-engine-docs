# 逆运动学肢体动画

Wallpaper Engine 支持木偶模型的逆运动学动画。这种方法可以让你为角色的关节定义合理的运动范围，而 Wallpaper Engine 将动态地为整个肢体的运动制作动画。

在尝试本教程之前，你应该已经阅读并理解了[操控变形动画介绍](/wallpaper-engine-docs/scene/puppet-warp/introduction)。

## 逆运动学肢体基本介绍

我们通常建议对[角色表](/wallpaper-engine-docs/scene/puppet-warp/charactersheet)使用逆运动学肢体以获得最佳视觉效果。但是，你也可以将逆运动学肢体用于简单的操控变形动画。在本入门指南中，我们将使用一个简单的简笔画模型来解释逆运动学肢体的基本形式以及核心思想。

### 为骨骼创建逆运动学肢体

要开始使用逆运动学肢体，请先为操控变形图层创建几何图形，就像创建任意普通变形动画一样。逆运动学的第一个重要步骤是骨架设置，你需要指定模型的骨架。

在我们的示例中，我们有一个简单的火柴人图形，我们用它来展示基本的逆向运动学设置。我们先将 **主要骨骼** 设置在躯干区域。从躯干延伸到角色腿部顶端的髋关节。确保每条腿都有一个单独的骨骼，这一点很重要，因为两条腿都需要能独立运动，为此我们在膝盖和脚上创建骨骼。

然后重复类似的操作，在胸部区域创建骨骼。从这个骨骼延伸到左肩和右肩，进一步延伸到手臂关节和手关节。

最后按你的需求为角色添加可能需要的任意其他骨骼，例如头部骨骼。

### 启动逆向运动学肢体

逆运动学通常只需要对每个肢体的最后一个骨骼启用即可。例如，对于手臂来说，选择的是最后一个手部骨骼，对于腿来说，选择的是代表脚的骨骼。选择最后一个骨骼，然后单击右侧的 **编辑约束**。在 **简单** 预设选项卡下，选择 **逆运动学臂/腿**。你可以将 **模式** 选项更改为 **高级** 来进一步调整它，尽管在大多数情况下，使用简单版本就足够了。你可以在稍后进一步调整此设置。

在以下视频中观看骨架设置：

<video width="100%" controls loop>
  <source :src="$withBase('/videos/ik_bones.mp4')" type="video/mp4">
  Your browser does not support the video tag.
</video>

### 调整朝向的位置

配置好逆运动学肢体后，你需要对逆运动学骨骼进行一些额外的调整，否则可能会出现单个肢体异常运动和挥舞的情况。

在操控变形的骨架设置中，选中角色的逆运动骨骼，调整**角度**，**使红色箭头指向肢体的方向**。例如，在我们的例子中，我们转动角度，使其面向手的方向。对所有相关肢体重复此过程，如以下视频所示：

<video width="100%" controls loop>
  <source :src="$withBase('/videos/ik_angle.mp4')" type="video/mp4">
  Your browser does not support the video tag.
</video>

## 基本逆运动学肢体动画示例

现在我们已经完成了基本的操控变形设置，接下来要为角色模型创建动画。创建一个新动画并配置所需的动画长度。我们需要动画能够循环，因此启用了 **环绕循环帧** 选项。这能让我们创建复杂动画，并且 Wallpaper Engine 将始终让动画结束在它们开始的地方，以实现流畅的动画循环。

在我们的示例中，我们抓住角色的主要骨骼并将其向下拖动，使我们的角色将腿和手臂移动到蹲下的位置。然后，我们将时间轴滑块移动到动画时间轴的正中间。基于上述同样的理由，我们不需要将滑块拖动到末尾，因为我们启用了 **环绕循环帧**，Wallpaper Engine 会为我们自动完成动画的剩余部分，因此也不需要定义结束位置。然后，我们将角色的主要骨骼向上移动，这样会根据配置自动移动所有的逆向运动学肢体。你会注意到，双脚在肢体过度伸展之前是保持在原地的，并且只有在整个骨骼完全伸展后才离开地面。所有相关的肢体都产生了逼真的跳跃动作，你可以在以下视频中观看整个过程和最终结果：

<video width="100%" controls loop>
  <source :src="$withBase('/videos/ik_simple_animation.mp4')" type="video/mp4">
  Your browser does not support the video tag.
</video>

### 使用目标控制器动画

我们前面的跳跃动画示例有点过于简单了，无法快速展示逆向运动学的肢体运动。通常你无需直接对骨骼的动画进行处理，而是使用显示在动画概览中的 **目标控制器**。

**目标控制器显示为方块而不是圆点**，因此你可以很容易的区分它们。目标控制器会影响它们所属的整个肢体的位置，它们可以让你根据该肢体的逆运动学配置轻松地对整个肢体进行动画处理。你还可以过度拉伸目标控制器，它会自动对齐肢体，就像手动拉动它一样。

在以下视频展示了一个简单的示例，注意只对方块形状的目标控制器进行动画处理，而不是对手臂本身的骨骼进行动画处理：

<video width="100%" controls loop>
  <source :src="$withBase('/videos/ik_target_controllers.mp4')" type="video/mp4">
  Your browser does not support the video tag.
</video>

### 调整方向控制器

你可能已经注意到，Wallpaper Engine 会沿着逆运动学肢体显示通向四肢中心的其他点。这些就是所谓的定向控制器，它们决定了肢体的扭曲方向。你可以重新定位它们以调整肢体的扭转方向。你可以在动画开始之前这么做，也可以在动画期间移动它们。观看以下视频，了解方向控制器如何改变逆运动学肢体动画的行为：

<video width="100%" controls loop>
  <source :src="$withBase('/videos/ik_orientation_controller.mp4')" type="video/mp4">
  Your browser does not support the video tag.
</video>