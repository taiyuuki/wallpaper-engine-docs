# 3D 透视挤压

使用操控变形动画，你还可以模拟 2D 图像的 3D 透视。我们将使用角色表示例中的武士来展示这个示例。但是，使用角色表是非必要的，你也可以对普通模型使用以获得类似的结果。

在尝试本教程之前，你应该已经阅读并理解了[操控变形动画介绍](/wallpaper-engine-docs/scene/puppet-warp/introduction)。

## 为操控变形设置几何图形

进入操控变形动画的 **几何图形** 步骤，并确保各项参数的设置都符合你的需求。一旦在 **几何图形** 设置中更改细分数量和填充数量，那下一步操作很可能就得重做，因此在继续使用 3D 透视挤压功能之前，完成这些选项非常重要。

一个很诱人的做法是设置一个较高的细分值以便对网格进行更细粒度的控制，但这会使深度绘制更加困难，并降低壁纸的整体性能。或许你可以尝试将细分值设为 0 或 1，然后单击网格在稍后要拉伸的位置放置切片。这能令你更好地控制网格，并使事情更简单，需要处理的几何图形更少。

对几何图形的基本设置感到满意后，在操控变形的 **几何图形** 步骤中启用 **3D 透视挤压**。

## 绘制深度地图

单击 **绘制深度** 按钮，在左侧会显示深度绘制的选项。选择一个绘画类型（**增加**、**降低**、**扁平化**、**平滑**），它们可以分别为深度蒙版增加或减少感知的深度。通常你不一定需要非常精确的绘制才能获得良好的效果，但如果你需要完美的精度，你可以导出深度蒙版图，在第三方图像编辑器中编辑它，然后将其导入回 Wallpaper Engine。

绘制深度蒙版时，按住左 **Alt** 键并用鼠标单击拖动可以旋转和平移模型。这能让你看到对象在以后的动画中具有什么样的 3d 感知深度。

完成深度蒙版后，可以微调 **挤压比例** 选项，增加或减少 3D 效果的感知深度。只有当你打算将对象旋转至背面时，**剔除** 选项才有意义。如果将此选项设置为**正常**，则图层的背面是透明的，而将其设置为 **没有剔除** 则会将纹理镜像到背面。在绝大多数情况下，你可以忽略此选项，只有当你在动画过程中需要将对象旋转超过 180° 时，它才有意义。

::: tip
单击 **锁定几何图形以进行顶点编辑**，你甚至可以在接下来的 **变形** 菜单中单独更改每个顶点的深度。
:::

你可以在示例视频看到这个过程，我为角色绘制了深度图：

<video width="100%" controls>
  <source :src="$withBase('/videos/puppet_warp_extrusion_painting.mp4')" type="video/mp4">
  Your browser does not support the video tag.  
</video>

## 在动画中添加 3D 透视效果

为了使 3D 效果变得可见，你需要对 **角度**的 **X** 轴或 **Y** 轴进行动画处理。在我们的示例中，我们只需要对连接在主要骨骼后面第一个骨骼的 **Y** 轴进行动画处理，使角色看起来像在不断地左右转动。请记住，骨骼的顺序很重要，如果你想让角色的整个身体转动，最好通过动画将其添加到第一个骨骼中。

::: tip
对 **Y** 轴进行动画处理会使运动向左/向右显示，对 **X** 轴进行动画处理会使运动向上/向下显示。
:::

我们选择骨骼并隐藏除 **角度Y** 之外的所有属性。角度Y 的关键帧值从 **0** 开始，然后在几帧后过渡到 **-15**，然后过渡到 **+15**，然后再次盘旋回 **-15**。最后在 **0** 处结束。在我们的示例中，这样足以创建左右运动的3d感知。你可以在以下视频中看到此过程和最终结果：

<video width="100%" controls>
  <source :src="$withBase('/videos/puppet_warp_extrusion_animation.mp4')" type="video/mp4">
  Your browser does not support the video tag.
</video>

## 透视效果的替代方法

除了实际对透视进行动画处理之外，你可能会发现，作为替代方法，只需在图层底部的 **杂项** 部分启用 **透视** 选项即可。这将始终启用 3D 拉伸，一开始可能不太合适，但你可以进行不断尝试，调整 3D 挤压的 **挤压比例** 选项，看看效果如何。
